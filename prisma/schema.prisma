generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Character {
  char_id           BigInt     @id @default(autoincrement())
  name              String?    @db.VarChar(50)
  personality       String?
  speaking_style    String?
  background        String?
  example_dialogues Json?
  char_created_at   DateTime?  @default(now()) @db.Timestamptz(6)
  user_id           BigInt
  User              User       @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_character_user")
  Sessions          Sessions[]
}

model User {
  user_id                BigInt                   @id @default(autoincrement())
  email                  String?                  @db.VarChar(255)
  nickname               String?                  @db.VarChar(50)
  hashed_password        String?                  @db.VarChar(255)
  user_created_at        DateTime?                @default(now()) @db.Timestamptz(6)
  Character              Character[]
  Sessions               Sessions[]
  experiment_assignments experiment_assignments[]
}

model Messages {
  message_id         BigInt    @id @default(autoincrement())
  role               String?   @db.VarChar(20)
  content            String?
  message_created_at DateTime? @default(now()) @db.Timestamptz(6)
  session_id         BigInt
  experiment_key     String?   @db.VarChar(100)
  Sessions           Sessions  @relation(fields: [session_id], references: [session_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_messages_session")
}

model Sessions {
  session_id         BigInt     @id @default(autoincrement())
  session_created_at DateTime?  @default(now()) @db.Timestamptz(6)
  user_id            BigInt
  char_id            BigInt
  Messages           Messages[]
  Character          Character  @relation(fields: [char_id], references: [char_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_sessions_char")
  User               User       @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_sessions_user")
}

model experiment_assignments {
  experiment_key String  @db.VarChar(100)
  user_id        BigInt
  group          String? @db.VarChar(20)
  User           User    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_experiment_user")

  @@id([experiment_key, user_id])
}
